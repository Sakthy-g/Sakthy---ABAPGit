/*
 * Copyright (C) 2009-2018 SAP SE or an SAP affiliate company. All rights reserved.
 */
jQuery.sap.declare("fcg.mdg.editbp.handlers.BankAccount");jQuery.sap.require("fcg.mdg.editbp.util.DataAccess");fcg.mdg.editbp.handlers.BankAccount={oBankAccontLayout:"",BankQueryModel:[],oBankModel:"",vBankCreated:0,i18nModel:"",vReEditIndex:"",oReEditModel:"",oReEditChngModel:"",oBankRslts:"",BankChngQueryModel:[],oWizrdCntrlr:"",vBankChanged:0,aCreatedBankId:[],aDeletedBankId:[],bankKeySearchResult:"",oBankValueItemTemp:"",oBankKeySearchResult:"",oChngBankModel:"",oDltBankModel:"",BankDltQueryModel:[],aChangedBanks:[],valueHelpFlag:"",oBankAccounts:[],vSelectedIndex:"",ibanFlag:"",clearGlobalVariables:function(){if(this.oBankAccontLayout!==undefined&&this.oBankAccontLayout!==""){try{this.oBankAccontLayout.destroy();}catch(e){}}this.oBankAccontLayout="";this.BankQueryModel=[];this.oBankModel="";this.oBankRslts="";this.BankChngQueryModel=[];this.aCreatedBankId=[];this.aDeletedBankId=[];this.bankKeySearchResult="";this.oBankValueItemTemp="";this.oBankKeySearchResult="";this.oChngBankModel="";this.oDltBankModel="";this.BankDltQueryModel=[];this.aChangedBanks=[];this.valueHelpFlag="";this.oBankAccounts=[];this.ibanFlag="";},getBankAccounts:function(w){this.oWizrdCntrlr=w;if(this.oBankRslts===""||this.oBankRslts===undefined){this.aCreatedBankId=[];this.aDeletedBankId=[];var p="/BP_RootCollection(BP_GUID="+w.sItemPath+")?$expand=";var q=p+"BP_BankAccountsRel";var r=fcg.mdg.editbp.util.DataAccess.readData(q,w);for(var i=0;i<r.BP_BankAccountsRel.results.length;i++){var R=r.BP_BankAccountsRel.results[i].BANKDETAILID;this.oBankAccounts.push(R);}this.oBankRslts=r;}var e=w.bpHookModifyBankAccounts(q,r,this);if(e!==undefined){this.oBankRslts=e;}this.setActionLayout(this.oBankRslts,w);},setActionLayout:function(r,w){w.getView().byId("entityStep").setNextStep(w.getView().byId("actionStep"));if(w.oActionLayout===""){w.oActionLayout=sap.ui.xmlfragment('fcg.mdg.editbp.frag.generic.SelectAction',w);}w.getView().byId("actionLayout").setVisible(true);w.getView().byId("actionLayout").addContent(w.oActionLayout);w.setRadioButtonText();if(r.BP_BankAccountsRel.results.length===0){sap.ui.getCore().byId("deleteRB").setEnabled(false);sap.ui.getCore().byId("changeRB").setEnabled(false);sap.ui.getCore().byId("actionRBG").setSelectedIndex(-1);}else{sap.ui.getCore().byId("deleteRB").setEnabled(true);sap.ui.getCore().byId("changeRB").setEnabled(true);sap.ui.getCore().byId("actionRBG").setSelectedIndex(1);}if(this.BankDltQueryModel.length===this.oBankAccounts.length){sap.ui.getCore().byId("deleteRB").setEnabled(false);sap.ui.getCore().byId("changeRB").setEnabled(false);sap.ui.getCore().byId("actionRBG").setSelectedIndex(-1);}},handleBankAccounts:function(w){if(w.vCurrentActionId==="createRB"){this.createChangeBankAccounts(w);}else if(w.vCurrentActionId==="changeRB"){if(w.reEdit===""){if(this.oBankRslts.BP_BankAccountsRel.results.length>1){this.setSelectBankRecord(w,this.oBankRslts);}else if(this.oBankRslts.BP_BankAccountsRel.results.length===1){this.createChangeBankAccounts(w);}}else{this.createChangeBankAccounts(w);}}else if(w.vCurrentActionId==="deleteRB"){if(this.oBankRslts.BP_BankAccountsRel.results.length>=1){this.setSelectBankRecord(w,this.oBankRslts);}}},setSelectBankRecord:function(c,r){var m=new sap.ui.model.json.JSONModel();var s={dataitems:[]};if(c.vCurrentActionId==="deleteRB"){c.getView().byId("actionStep").setNextStep(c.getView().byId("editStep"));}else{c.getView().byId("actionStep").setNextStep(c.getView().byId("selectEntityInstanceStep"));}if(c.oCommunicationListRBG===""){c.oCommunicationListRBG=sap.ui.xmlfragment('fcg.mdg.editbp.frag.generic.SelectEntityInstance',c);}if(c.vCurrentActionId==="deleteRB"){c.getView().byId("editLayout").setVisible(true);if(c.getView().byId("editLayout").getContent().length>0){c.getView().byId("editLayout").removeAllContent();}c.getView().byId("editLayout").addContent(c.oCommunicationListRBG);}else{c.getView().byId("selectEntityInstanceLayout").setVisible(true);c.getView().byId("selectEntityInstanceLayout").addContent(c.oCommunicationListRBG);}for(var i=0;i<r.BP_BankAccountsRel.results.length;i++){var b=r.BP_BankAccountsRel.results[i];var d={"RBText":fcg.mdg.editbp.util.Formatter.createRecordsToProcess(this.i18nModel,b)};s.dataitems.push(d);}var B=sap.ui.getCore().byId("selectDataListRBG");m.setData(s);B.setModel(m);B.setSelectedIndex(-1);},createChangeBankAccounts:function(w){this.vReEditIndex="";var v;if(w.vCurrentActionId==="createRB"){w.getView().byId("actionStep").setNextStep(w.getView().byId("editStep"));this.loadBanklayout(w);v=this.BankQueryModel;}else if(w.vCurrentActionId==="changeRB"){v=this.BankChngQueryModel;if(w.reEdit!=="X"){var c=new sap.ui.model.json.JSONModel();if(this.oBankRslts.BP_BankAccountsRel.results.length>1){w.getView().byId("selectEntityInstanceStep").setNextStep(w.getView().byId("editStep"));this.loadBanklayout(w);var s=sap.ui.getCore().byId("selectDataListRBG").getSelectedIndex();}else if(this.oBankRslts.BP_BankAccountsRel.results.length===1){w.getView().byId("actionStep").setNextStep(w.getView().byId("editStep"));this.loadBanklayout(w);s=0;}var S=this.oBankRslts.BP_BankAccountsRel.results[s];this.vSelectedIndex=s;c.setData(S);this.oBankAccontLayout.setModel(c);}}if(w.reEdit==="X"){var r=w.reEditSource.getParent().getParent().getParent();var R=r.getParent();this.vReEditIndex=R.indexOfContent(r);var m=new sap.ui.model.json.JSONModel();m.setData(v[this.vReEditIndex].body);this.oBankAccontLayout.setModel(m);}},loadBanklayout:function(c){if(this.oBankAccontLayout===""){this.oBankAccontLayout=sap.ui.xmlfragment('fcg.mdg.editbp.frag.bp.EditBank',c);}else{this.oBankAccontLayout.destroy();this.oBankAccontLayout=sap.ui.xmlfragment('fcg.mdg.editbp.frag.bp.EditBank',c);}var e=c.bpHookModifyBanklayout(c,this);if(e!==undefined){this.oBankAccontLayout=e;}c.getView().byId("editLayout").removeAllContent();c.getFileUploadData("editLayout");c.getView().byId("editLayout").addContent(this.oBankAccontLayout);},createBankAccountsDataModel:function(w){if(w.vCurrentActionId==="createRB"){this.createModel(w);}else if(w.vCurrentActionId==="changeRB"){this.changeModel(w);}else if(w.vCurrentActionId==="deleteRB"){this.deleteModel(w);}},createModel:function(c){var a=(JSON.parse(JSON.stringify(c.createdArray)));var u;var q={};if(c.reEdit===""){for(var i=0;i<a.length;){u="{";q.index=this.vBankCreated+1;q.entity=a[i].entity;u=u+"\""+a[i].field+"\":\""+a[i].value+"\",";for(var j=i+1;j<a.length;){if(a[i].entity===a[j].entity){u=u+"\""+a[j].field+"\":\""+a[j].value+"\",";a.splice(j,1);}else{j++;}}a.splice(i,1);u=u.substring(0,u.length-1)+"}";q.body=JSON.parse(u);this.createBankDetailId(q);this.aCreatedBankId.push(q.body.BANKDETAILID);this.BankQueryModel.push(q);this.oBankModel=new sap.ui.model.json.JSONModel();this.oBankModel.setData(q.body);}}else{for(var r=0;r<a.length;r++){this.BankQueryModel[this.vReEditIndex].body[a[r].field]=a[r].value;}this.oReEditModel=new sap.ui.model.json.JSONModel();this.oReEditModel.setData(this.BankQueryModel[this.vReEditIndex].body);}var e=c.bpHookModifyBankCreateModel(c,this);if(e!==undefined){this.BankQueryModel=e;}},createBankDetailId:function(q){var C=0,n,b;for(var c=0;c<=C;c++){C=C+1;n=("000000000"+C).slice(-4);if(this.oBankAccounts.indexOf(n)===-1){if(n!==b){if(this.aCreatedBankId.indexOf(n)>-1){continue;}else if(this.aCreatedBankId.indexOf(n)===-1){q.body["BANKDETAILID"]=n;return;}}}}},changeModel:function(c){var a=(JSON.parse(JSON.stringify(c.changedArray)));var u,s;var b,C;var q={};if(c.reEdit===""){for(var i=0;i<a.length;){if(this.oBankRslts.BP_BankAccountsRel.results.length===1){s=0;}else{if(sap.ui.getCore().byId("selectDataListRBG")!==undefined){s=sap.ui.getCore().byId("selectDataListRBG").getSelectedIndex();}}this.oBankRslts.BP_BankAccountsRel.results[s][a[i].field]=a[i].value;this.oBankRslts.BP_BankAccountsRel.results[s]["SelectIndex"]=s;u="{";var B=escape(this.oBankRslts.BP_BankAccountsRel.results[s].BANKDETAILID);q.header="BP_BankAccountCollection(BP_GUID="+c.sItemPath+",BANKDETAILID='"+B+"')";q.entity=a[i].entity;u=u+"\""+a[i].field+"\":\""+a[i].value+"\",";for(var j=i+1;j<a.length;){this.oBankRslts.BP_BankAccountsRel.results[s][a[j].field]=a[j].value;if(a[i].entity===a[j].entity){u=u+"\""+a[j].field+"\":\""+a[j].value+"\",";a.splice(j,1);}else{j++;}}a.splice(i,1);u=u.substring(0,u.length-1)+"}";this.oBankRslts.BP_BankAccountsRel.results[s].ChangeData=JSON.parse(u);q.body=this.oBankRslts.BP_BankAccountsRel.results[s];if(this.oBankRslts.BP_BankAccountsRel.results[s].EDIT!=="X"){q.index=this.aChangedBanks.length-1;this.oBankRslts.BP_BankAccountsRel.results[s]["INDEX"]=q.index;this.BankChngQueryModel.push(q);this.aChangedBanks.push(q.body.BANKDETAILID);}else{b=this.oBankRslts.BP_BankAccountsRel.results[s].BANKDETAILID;C=this.aChangedBanks.indexOf(b);this.BankChngQueryModel[C]=q;}this.oChngBankModel=new sap.ui.model.json.JSONModel();this.oChngBankModel.setData(this.oBankRslts.BP_BankAccountsRel.results[s]);}}else{var m;b=this.BankChngQueryModel[this.vReEditIndex].body.BANKDETAILID;for(var d=0;d<this.oBankRslts.BP_BankAccountsRel.results.length;d++){if(b===this.oBankRslts.BP_BankAccountsRel.results[d].BANKDETAILID){m=d;}}for(var r=0;r<a.length;r++){this.BankChngQueryModel[this.vReEditIndex].body[a[r].field]=a[r].value;this.BankChngQueryModel[this.vReEditIndex].body.ChangeData[a[r].field]=a[r].value;this.oBankRslts.BP_BankAccountsRel.results[m][a[r].field]=a[r].value;this.oBankRslts.BP_BankAccountsRel.results[m].ChangeData[a[r].field]=a[r].value;}this.oReEditChngModel=new sap.ui.model.json.JSONModel();this.oReEditChngModel.setData(this.BankChngQueryModel[this.vReEditIndex].body);}var e=c.bpHookModifyBankChangeModel(c,this);if(e!==undefined){this.oBankRslts=e;}},deleteModel:function(c){var d={};if(sap.ui.getCore().byId("selectDataListRBG")!==undefined){var s=sap.ui.getCore().byId("selectDataListRBG").getSelectedIndex();}this.oBankRslts.BP_BankAccountsRel.results[s]["SelectIndex"]=s;var p="/BP_RootCollection(BP_GUID="+c.sItemPath+")?$expand=";var q=p+"BP_BankAccountsRel";var r=fcg.mdg.editbp.util.DataAccess.readData(q,c);for(var i=0;i<r.BP_BankAccountsRel.results.length;i++){if(this.oBankRslts.BP_BankAccountsRel.results[s].BANKDETAILID===r.BP_BankAccountsRel.results[i].BANKDETAILID){var R=i;}}d.body=r.BP_BankAccountsRel.results[R];var b=escape(d.body.BANKDETAILID);d.header="BP_BankAccountCollection(BP_GUID="+c.sItemPath+",BANKDETAILID='"+b+"')";if(this.aChangedBanks.length>0){if(this.aChangedBanks.indexOf(d.body.BANKDETAILID)>-1){var C=this.aChangedBanks.indexOf(d.body.BANKDETAILID);this.aChangedBanks.splice(C,1);this.BankChngQueryModel.splice(C,1);c.getView().byId("bankChangeLayout").getContent()[C].destroy();this.oBankRslts.BP_BankAccountsRel.results.splice(s,1);}else{this.oBankRslts.BP_BankAccountsRel.results.splice(s,1);}}else{this.oBankRslts.BP_BankAccountsRel.results.splice(s,1);}this.BankDltQueryModel.push(d);var l=d.body;l.ChangeData={};this.oDltBankModel=new sap.ui.model.json.JSONModel();this.oDltBankModel.setData(l);var e=c.bpHookModifyBankDeleteModel(c,this);if(e!==undefined){this.oBankRslts=e;}},undoBankChanges:function(u,a,e,E,w){var b,I;var l=this;var v;var d=u.getParent().getContent()[0].getText();var p="/BP_RootCollection(BP_GUID="+w.sItemPath+")?$expand=";var q=p+"BP_BankAccountsRel";var m=new sap.ui.model.odata.ODataModel("/sap/opu/odata/sap/MDG_EDIT_CUSTOMER",true);var o=w.bpHookModifyBankUndoChanges(q,m,w,this);if(o!==undefined){q=o;}if(a===0){for(var i=0;i<w.oDupCheckData.length;){if(w.oDupCheckData[i].createdIndex===this.BankQueryModel[e].index&&w.oDupCheckData[i].entity==="BP_BankAccount"){w.oDupCheckData.splice(i,1);}else{i++;}}this.aCreatedBankId.splice(e,1);this.BankQueryModel.splice(e,1);}else if(a===1){b=this.BankChngQueryModel[e].body.BANKDETAILID;for(i=0;i<w.aEntityValue.length;i++){if("BankRB-"+b===w.aEntityValue[i]){w.aEntityValue.splice(i,1);break;}}this.aChangedBanks.splice(e,1);I=this.oBankAccounts.indexOf(b);for(var i=0;i<this.oBankRslts.BP_BankAccountsRel.results.length;i++){if(b===this.oBankRslts.BP_BankAccountsRel.results[i].BANKDETAILID){var c=i;}}this.BankChngQueryModel.splice(e,1);w.aEntityValue.splice(e,1);m.read(q,null,null,true,function(r,f){if(r.BP_BankAccountsRel.results.length>0){l.oBankRslts.BP_BankAccountsRel.results[c]=r.BP_BankAccountsRel.results[I];}});}else if(a===2){b=this.BankDltQueryModel[e].body.BANKDETAILID;for(i=0;i<w.aEntityValue.length;i++){if("BankRB-"+b===w.aEntityValue[i]){w.aEntityValue.splice(i,1);break;}}I=this.oBankAccounts.indexOf(b);this.BankDltQueryModel.splice(e,1);m.read(q,null,null,true,function(r,f){if(r.BP_BankAccountsRel.results.length>0){l.oBankRslts.BP_BankAccountsRel.results.push(r.BP_BankAccountsRel.results[I]);}});}},getBankModel:function(){if(this.oWizrdCntrlr.vCurrentActionId==="createRB"){return this.oBankModel;}else if(this.oWizrdCntrlr.vCurrentActionId==="changeRB"){return this.oChngBankModel;}else if(this.oWizrdCntrlr.vCurrentActionId==="deleteRB"){return this.oDltBankModel;}},seti18nModel:function(i){this.i18nModel=i;},_countryVH:function(p,c,C){var o=fcg.mdg.editbp.util.DataAccess.getValueHelpData()[5].data;var g=C;var l=this;var P=p;var a=sap.ui.getCore().byId(p);var b=sap.ui.getCore().byId("SF-BP_BankAccounts-Txt_BANK_ACCT");if(p==="SF-BP_BankAccounts-Txt_BANK_CTRY"){var d=sap.ui.getCore().byId("SF-BP_BankAccounts-Txt_BANK_CTRY__TXT");var B=sap.ui.getCore().byId("SF-BP_BankAccounts-Txt_BANK_KEY");var e=sap.ui.getCore().byId("SF-BP_BankAccounts-Txt_BANK_NAME");}if(sap.ui.getCore().byId("CountryDialog")!==undefined){sap.ui.getCore().byId("CountryDialog").destroy();this.oCountryValueHelp="";}var f=new sap.m.SelectDialog({id:"CountryDialog",title:this.i18nModel.getText("COUNTRIES"),noDataText:this.i18nModel.getText("LOAD")+"...",items:{path:"/CountryValues",template:new sap.m.StandardListItem({title:"{TEXT}",description:"{KEY}"})},confirm:function(i){l.valueHelpFlag="X";a.setValueState("None");a.setValueStateText("");b.setValueState("None");b.setValueStateText("");a.setValue(i.getParameters().selectedItem.getProperty("description"));a.fireEvent("change");l.valueHelpFlag="";if(d!==undefined){d.setValue(i.getParameters().selectedItem.getProperty("title"));d.fireEvent("change");if(B!==undefined){B.setValueState("None");B.setValueStateText("");g._fetchBankName();}l._deriveIban(p,c,C);}},search:function(j){var v=j.getParameter("value").toUpperCase();v=v.replace(/^[ ]+|[ ]+$/g,'');var k=f.getItems();for(var i=0;i<k.length;i++){if(v.length>0){var s=k[i].getBindingContext().getProperty("KEY");var m=k[i].getBindingContext().getProperty("TEXT");if(s.toUpperCase().indexOf(v)===-1&&m.toUpperCase().indexOf(v)===-1){k[i].setVisible(false);}else{k[i].setVisible(true);}}else{k[i].setVisible(true);}}},liveChange:function(j){var v=j.getParameter("value").toUpperCase();v=v.replace(/^[ ]+|[ ]+$/g,'');var k=f.getItems();for(var i=0;i<k.length;i++){if(v.length>0){var m=k[i].getBindingContext().getProperty("KEY");var n=k[i].getBindingContext().getProperty("TEXT");if(m.toUpperCase().indexOf(v)===-1&&n.toUpperCase().indexOf(v)===-1){k[i].setVisible(false);}else{k[i].setVisible(true);}}else{k[i].setVisible(true);}}}});if(o.results.length>0){var I=new sap.m.StandardListItem({title:"{TEXT}",description:"{KEY}",active:true});var h=new sap.ui.model.json.JSONModel();h.setData(o);f.setModel(h);f.setGrowingThreshold(o.results.length);f.bindAggregation("items","/results",I);}else{f.setNoDataText(g.getView().getModel("i18n").getProperty("NO_DATA"));}var E=C.bpHookModifyBankCountryValueHelp(p,f,c,C,this);if(E!==undefined){f=E;}f.open();},_BankKeyVH:function(p,c,C){var a=sap.ui.getCore().byId("SF-BP_BankAccounts-Txt_BANK_CTRY").getValue();var b=sap.ui.getCore().byId("SF-BP_BankAccounts-Txt_BANK_CTRY");var B=sap.ui.getCore().byId("SF-BP_BankAccounts-Txt_BANK_KEY");var o=sap.ui.getCore().byId("SF-BP_BankAccounts-Txt_BANK_NAME");var d=sap.ui.getCore().byId("SF-BP_BankAccounts-Txt_BANK_ACCT");if(a===""){B.setValueState("Error");B.setValueStateText(this.i18nModel.getText("BANK_COUNTRY_CHECK"));b.setValueState("Error");b.setValueStateText(this.i18nModel.getText("BlnkCountryMSG"));return;}if(b.getValueState()==="Error"){B.setValueState("Error");B.setValueStateText(b.getValueStateText());return;}if(a!==""){var g=this;var e=B;var f=o;if(sap.ui.getCore().byId("BankKeyDialog")!==undefined){sap.ui.getCore().byId("BankKeyDialog").destroy();this.bankKeySearchResult="";}var s=new sap.m.SelectDialog({id:"BankKeyDialog",title:this.i18nModel.getText("BANK_KEYS"),noDataText:this.i18nModel.getText("LOAD")+"...",confirm:function(h){g.valueHelpFlag="X";d.setValueState("None");d.setValueStateText("");e.setValueState("None");e.setValueStateText("");e.setValue(h.getParameters().selectedItem.getProperty("description"));var i='('+g.i18nModel.getText("NoDesc")+')';if(i===h.getParameters().selectedItem.getProperty("title")){f.setValue();}else{f.setValue(h.getParameters().selectedItem.getProperty("title"));}e.fireEvent("change");g.valueHelpFlag="";f.fireEvent("change");g._deriveIban(p,c,C);},search:function(h){var v=h.getParameter("value").toUpperCase();v=v.replace(/^[ ]+|[ ]+$/g,'');if(g.oBankKeySearchResult){var I=new sap.ui.model.json.JSONModel();I.setData(g.oBankKeySearchResult);s.setModel(I);if(v.length==0){s.setGrowingThreshold(15);}else{s.setGrowingThreshold(g.oBankKeySearchResult.results.length);}s.bindAggregation("items","/results",g.oBankValueItemTemp);}var j=s.getItems();for(var i=0;i<j.length;i++){if(v.length>0){var k=j[i].getBindingContext().getProperty("TEXT");var l=j[i].getBindingContext().getProperty("KEY");if(k.toUpperCase().indexOf(v)===-1&&l.toUpperCase().indexOf(v)===-1){j[i].setVisible(false);}else{j[i].setVisible(true);}}else{j[i].setVisible(true);}}}});if(!g.bankKeySearchResult){var q="/ValueHelpCollection?$filter="+jQuery.sap.encodeURL("ENTITY eq 'BP_BankAccount' and ATTR_NAME eq 'BANK_KEY' and FILTER eq "+"'COUNTRY="+a+"'");var t=this;var m=new sap.ui.model.odata.ODataModel("/sap/opu/odata/sap/MDG_EDIT_CUSTOMER",true);m.read(q,null,null,true,function(r,h){if(r.results.length>0){var i=new sap.m.StandardListItem({title:{parts:[{path:'TEXT'},{path:'KEY'}],formatter:t.checkDesc},description:"{KEY}",active:true});var I=new sap.ui.model.json.JSONModel();I.setData(r);s.setModel(I);s.setGrowingThreshold(15);s.bindAggregation("items","/results",i);g.oBankValueItemTemp=i;g.oBankKeySearchResult=r;}else{s.setNoDataText(g.i18nModel.getText("NO_DATA"));}},function(h){s.setNoDataText(g.i18nModel.getText("NO_DATA"));});}else{}var E=C.bpHookModifyBankKeyValueHelp(p,c,s,C,this);if(E!==undefined){s=E;}s.open();}},checkDesc:function(d,v){if((d===""||d===null||d===undefined)&&(v===""||v===null||v===undefined))return" ";else if((d===""||d===null||d===undefined)&&(v!==""||v!==null||v!==undefined)){var s='('+fcg.mdg.editbp.handlers.BankAccount.i18nModel.getText("NoDesc")+')';return s;}else return d;},_deriveIban:function(p,c,C){var g=this;var b=sap.ui.getCore().byId("SF-BP_BankAccounts-Txt_BANK_ACCT");var a=sap.ui.getCore().byId("SF-BP_BankAccounts-Txt_BANK_ACCT").getValue();var i=sap.ui.getCore().byId("SF-BP_BankAccounts-Txt_IBAN");var G=this;if(a.replace(/^[ ]+|[ ]+$/g,'')===""){sap.ui.getCore().byId("SF-BP_BankAccounts-Txt_BANK_ACCT").setValue();i.setValue();i.setValueState("None");}if(sap.ui.getCore().byId("SF-BP_BankAccounts-Txt_BANK_CTRY").getValue()!==""&&sap.ui.getCore().byId("SF-BP_BankAccounts-Txt_BANK_KEY").getValue()!==""&&sap.ui.getCore().byId("SF-BP_BankAccounts-Txt_BANK_ACCT").getValue()!==""){if(sap.ui.getCore().byId("SF-BP_BankAccounts-Txt_BANK_CTRY").getValueState()==="None"&&sap.ui.getCore().byId("SF-BP_BankAccounts-Txt_BANK_KEY").getValueState()==="None"){var B=sap.ui.getCore().byId("SF-BP_BankAccounts-Txt_BANK_CTRY").getValue();var s=sap.ui.getCore().byId("SF-BP_BankAccounts-Txt_BANK_KEY").getValue();var d=sap.ui.getCore().byId("SF-BP_BankAccounts-Txt_BANK_ACCT").getValue();var q="/BP_BankAccountCollection?$filter="+jQuery.sap.encodeURL("BANK_CTRY eq '"+B+"' and BANK_KEY eq '"+s+"' and BANK_ACCT eq '"+d+"'");var e=C.bpHookModifyBankDeriveIban(p,c,q,C,this);if(e!==undefined){q=e;}var i=sap.ui.getCore().byId("SF-BP_BankAccounts-Txt_IBAN");var m=new sap.ui.model.odata.ODataModel("/sap/opu/odata/sap/MDG_EDIT_CUSTOMER",true);m.read(q,null,null,true,function(f,E){if(f.results.length>0){G.valueHelpFlag="X";b.setValueState("None");b.setValueStateText("");var I=f.results[0].IBAN;i.setValueState("None");i.setValue(I);i.fireEvent("change");G.valueHelpFlag="";if(i.getValue()!==""){i.setValueState("Warning");i.setValueStateText(G.i18nModel.getText("IBAN_WARNING"));}}else if(f.results.length===0||i.getValue()===""){i.setValueState("Warning");i.setValueStateText(G.i18nModel.getText("IBAN_NO_GEN"));}},function(E){if(sap.ui.getCore().byId("SF-BP_BankAccounts-Txt_BANK_CTRY").getValue()!==""&&sap.ui.getCore().byId("SF-BP_BankAccounts-Txt_BANK_KEY").getValue()!==""&&sap.ui.getCore().byId("SF-BP_BankAccounts-Txt_BANK_ACCT").getValue()!==""){var f=JSON.parse(E.response.body);var h=f.error.message.value;i.setValue();i.setValueState("Error");i.setValueStateText(h);b.setValueState("Error");b.setValueStateText(h);}});}}}};
