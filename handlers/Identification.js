/*
 * Copyright (C) 2009-2018 SAP SE or an SAP affiliate company. All rights reserved.
 */
jQuery.sap.declare("fcg.mdg.editbp.handlers.Identification");fcg.mdg.editbp.handlers.Identification={oController:"",oResult:"",oIdentificationLayout:"",oIdModel:"",oIDQueryModel:[],oIDDeleteQueryModel:[],oIDDeleteModel:[],vIDCreated:0,vReEditIndex:"",oReEditModel:"",clearGlobalVariables:function(){this.oResult="";this.oIdModel="";this.oIDQueryModel=[];this.oIDDeleteQueryModel=[];this.oIDDeleteModel=[];this.vIDCreated=0;this.vReEditIndex="";this.oReEditModel="";},getIdentificationData:function(w){if(this.oResult===""||this.oResult===undefined){this.oController=w;var p="/BP_RootCollection(BP_GUID="+w.sItemPath+")?$expand=";var q=p+"BP_IdentificationNumbersRel";var r=fcg.mdg.editbp.util.DataAccess.readData(q,w);this.setIdentificationResults(r);var e=this.oController.bpHookModifygetIdentificationData(q,this);if(e!==undefined){r=e;}}this.setActionLayout(this.oResult);},setIdentificationResults:function(r){this.oResult=r;},getIdentificationResults:function(){return this.oResult;},setActionLayout:function(r){this.oController.getView().byId("entityStep").setNextStep(this.oController.getView().byId("actionStep"));if(this.oController.oActionLayout===""){this.oController.oActionLayout=sap.ui.xmlfragment("fcg.mdg.editbp.frag.generic.SelectAction",this.oController);}if(sap.ui.getCore().byId("actionRBG")!==undefined){sap.ui.getCore().byId("actionRBG").setSelectedIndex(-1);}this.oController.getView().byId("actionLayout").setVisible(true);this.oController.getView().byId("actionLayout").addContent(this.oController.oActionLayout);this.oController.setRadioButtonText();sap.ui.getCore().byId("changeRB").setVisible(false);if(r.BP_IdentificationNumbersRel.results.length===0){sap.ui.getCore().byId("deleteRB").setEnabled(false);}else{sap.ui.getCore().byId("deleteRB").setEnabled(true);}this.oController.setActionView("actionStep","select_action");},handleIdentification:function(w){this.oController=w;if(w.vCurrentActionId==="createRB"){this.createIdentification();}else if(w.vCurrentActionId==="deleteRB"){var r=this.getIdentificationResults();this.handleDeleteIdentification(r);}},handleDeleteIdentification:function(r){if(r.BP_IdentificationNumbersRel.results.length>=1){this.setSelectEntityLayout(r);return;}},setSelectEntityLayout:function(r){var m=new sap.ui.model.json.JSONModel();var s={dataitems:[]};this.oController.getView().byId("actionStep").setNextStep(this.oController.getView().byId("editStep"));if(this.oController.oCommunicationListRBG===""){this.oController.oCommunicationListRBG=sap.ui.xmlfragment("fcg.mdg.editbp.frag.generic.SelectEntityInstance",this.oController);}if(this.oController.getView().byId("editLayout").getContent().length>0){this.oController.getView().byId("editLayout").removeAllContent();}this.oController.getView().byId("editLayout").setVisible(true);this.oController.getView().byId("editLayout").addContent(this.oController.oCommunicationListRBG);for(var i=0;i<r.BP_IdentificationNumbersRel.results.length;i++){var a=r.BP_IdentificationNumbersRel.results[i];var d={"RBText":a.IDENTIFICATIONTYPE__TXT+" ("+a.IDENTIFICATIONNUMBER+")"};s.dataitems.push(d);}var c=sap.ui.getCore().byId("selectDataListRBG");m.setData(s);c.setModel(m);c.setSelectedIndex(-1);},createIdentification:function(){this.vReEditIndex="";var v;var i="";this.oController.getView().byId("actionStep").setNextStep(this.oController.getView().byId("editStep"));if(this.oIdentificationLayout===""){this.oIdentificationLayout=sap.ui.xmlfragment("fcg.mdg.editbp.frag.bp.EditIdentification",this);}else{this.oIdentificationLayout.destroy();this.oIdentificationLayout=sap.ui.xmlfragment("fcg.mdg.editbp.frag.bp.EditIdentification",this);}var e=this.oController.bpHookModifycreateIdentification(this);if(e!==undefined){this.oIdentificationLayout=e;}this.oController.getView().byId("editLayout").setVisible(true);this.oController.getView().byId("editLayout").removeAllContent();this.oController.getFileUploadData("editLayout");this.oController.getView().byId("editLayout").addContent(this.oIdentificationLayout);v=this.oIDQueryModel;if(this.oController.reEdit==="X"){var r=this.oController.reEditSource.getParent().getParent().getParent();var R=r.getParent();this.vReEditIndex=R.indexOfContent(r);var m=new sap.ui.model.json.JSONModel();m.setData(v[this.vReEditIndex].body);this.oIdentificationLayout.setModel(m);i=v[this.vReEditIndex].body.IDENTIFICATIONTYPE;}this.loadDropDown(i);},loadDropDown:function(i){var r=fcg.mdg.editbp.util.DataAccess.getValueHelpData();var d=this.oController.i18nBundle.getText("NONE");d="("+d+")";var I=new sap.ui.model.json.JSONModel();if(this.oController.sCategory==="1"){I.setData(r[7].data);}else if(this.oController.sCategory==="2"){I.setData(r[9].data);}var a=new sap.ui.core.Item({key:"{KEY}",text:"{TEXT}"});var b=sap.ui.getCore().byId("SF-BP_IdentificationNumbersRel-IDTYPE");b.setModel(I);b.bindItems("/results",a);var e=new sap.ui.core.Item({key:"",text:d});b.addItem(e);if(i!==undefined){b.setSelectedKey(i);return;}b.setSelectedKey();},onIdentificationTypeChange:function(e){var i=sap.ui.getCore().byId("SF-BP_IdentificationNumbersRel-IDTYPE");var a=sap.ui.getCore().byId("SF-BP_IdentificationNumbersRel-IDNUMBER");var w=fcg.mdg.editbp.handlers.Identification.oController;if(i.getSelectedKey()!==""){a.setValueState("None");a.setValueStateText("");}if(i.getSelectedKey()===""&&a.getValue()!==""){a.setValueState("Error");a.setValueStateText(w.i18nBundle.getText("ID_TYPE_CHECK"));}w.onChange(e);if(i.getSelectedKey()!==""&&a.getValue()!==""){w.getView().byId("wizardId").validateStep(w.getView().byId("editStep"));}else{w.getView().byId("wizardId").invalidateStep(w.getView().byId("editStep"));}},onIDNumberChange:function(e){var w=fcg.mdg.editbp.handlers.Identification.oController;var i=sap.ui.getCore().byId("SF-BP_IdentificationNumbersRel-IDTYPE");var a=sap.ui.getCore().byId("SF-BP_IdentificationNumbersRel-IDNUMBER");var b=a.getValue();if(b.replace(/^[ ]+|[ ]+$/g,'')==="")a.setValue();if(i.getSelectedKey()===""&&a.getValue()!==""){a.setValueState("Error");a.setValueStateText(w.i18nBundle.getText("ID_TYPE_CHECK"));}if(a.getValue()===""){a.setValueState("None");a.setValueStateText();}w.onChange(e);if(i.getSelectedKey()!==""&&b!==""){w.getView().byId("wizardId").validateStep(w.getView().byId("editStep"));}else{w.getView().byId("wizardId").invalidateStep(w.getView().byId("editStep"));}},createIdentificationDataModel:function(w){if(w.vCurrentActionId==="createRB"){this.createModel(w);}else if(w.vCurrentActionId==="deleteRB"){this.deleteModel(w);}},deleteModel:function(c){var d={};if(sap.ui.getCore().byId("selectDataListRBG")!==undefined){var s=sap.ui.getCore().byId("selectDataListRBG").getSelectedIndex();}this.oResult.BP_IdentificationNumbersRel.results[s]["SelectIndex"]=s;d.body=this.oResult.BP_IdentificationNumbersRel.results[s];d.header="BP_IdentificationNumberCollection(BP_GUID="+c.sItemPath+",IDENTIFICATIONTYPE='"+d.body.IDENTIFICATIONTYPE+"',IDENTIFICATIONNUMBER='"+d.body.IDENTIFICATIONNUMBER+"')";this.oResult.BP_IdentificationNumbersRel.results.splice(s,1);this.oIDDeleteQueryModel.push(d);var l=d.body;l.ChangeData={};this.oIDDeleteModel=new sap.ui.model.json.JSONModel();this.oIDDeleteModel.setData(l);var e=this.oController.bpHookModifyIDDeleteModel(this);if(e!==undefined){this.oIDDeleteModel=e;}},createModel:function(c){var a=(JSON.parse(JSON.stringify(c.createdArray)));var u;var q={};if(c.reEdit===""){for(var i=0;i<a.length;){u="{";q.index=this.vIDCreated+1;q.entity=a[i].entity;if(a[i].key!==undefined){u=u+"\""+a[i].field+"\":\""+a[i].key+"\",";u=u+"\""+a[i].field+"__TXT"+"\":\""+a[i].value+"\",";}else{u=u+"\""+a[i].field+"\":\""+a[i].value+"\",";}for(var j=i+1;j<a.length;){if(a[i].entity===a[j].entity){if(a[j].key!==undefined){u=u+"\""+a[j].field+"\":\""+a[j].key+"\",";u=u+"\""+a[j].field+"__TXT"+"\":\""+a[j].value+"\",";}else{u=u+"\""+a[j].field+"\":\""+a[j].value+"\",";}a.splice(j,1);}else{j++;}}a.splice(i,1);u=u.substring(0,u.length-1)+"}";q.body=JSON.parse(u);this.oIDQueryModel.push(q);this.oIdModel=new sap.ui.model.json.JSONModel();this.oIdModel.setData(q.body);var e=this.oController.bpHookModifyIDCreateModel(this);if(e!==undefined){this.oIdModel=e;}}}else{for(var r=0;r<a.length;r++){this.oIDQueryModel[this.vReEditIndex].body[a[r].field]=a[r].value;}this.oReEditModel=new sap.ui.model.json.JSONModel();this.oReEditModel.setData(this.oIDQueryModel[this.vReEditIndex].body);}},getIDModel:function(){return this.oIdModel;},getDeletedIDModel:function(){return this.oIDDeleteModel;},getPayload:function(){var d=this.oIdModel.getData();var p={};p.IDENTIFICATIONTYPE=d.IDENTIFICATIONTYPE;p.IDENTIFICATIONNUMBER=d.IDENTIFICATIONNUMBER;},performUIValidations:function(w){var i=sap.ui.getCore().byId("SF-BP_IdentificationNumbersRel-IDTYPE");var a=sap.ui.getCore().byId("SF-BP_IdentificationNumbersRel-IDNUMBER");if(i.getSelectedKey()===""&&a.getValue()!==""){this.showPopUp(w,w.i18nBundle.getText("ID_TYPE_CHECK"));return false;}if(i.getSelectedKey()!==""&&a.getValue()===""){this.showPopUp(w,w.i18nBundle.getText("ID_VALUE_CHECK"));return false;}},showPopUp:function(w,t){var d=new sap.m.Dialog({title:w.i18nBundle.getText("ERROR"),type:"Message",state:w.i18nBundle.getText("ERROR"),content:[new sap.m.Text({text:t})],beginButton:new sap.m.Button({text:w.i18nBundle.getText("OK"),press:function(){d.close();}}),afterClose:function(){d.destroy();}});d.open();},undoIdentificationChanges:function(a,e){if(a===0){for(var i=0;i<this.oController.oDupCheckData.length;){if(this.oController.oDupCheckData[i].createdIndex===this.oIDQueryModel[e].index&&this.oController.oDupCheckData[i].entity==="BP_IdentificationNumber"){this.oController.oDupCheckData.splice(i,1);}else{i++;}}this.oIDQueryModel.splice(e,1);}else if(a===1){this.oResult.BP_IdentificationNumbersRel.results.push(this.oIDDeleteQueryModel[e].body);this.oIDDeleteQueryModel.splice(e,1);}}};
