/*
 * Copyright (C) 2009-2018 SAP SE or an SAP affiliate company. All rights reserved.
 */
jQuery.sap.declare("fcg.mdg.editbp.handlers.ContactPersonChange");fcg.mdg.editbp.handlers.ContactPersonChange={oController:"",oCPDeleteQueryModel:[],oCPDeleteModel:[],oWPModel:"",numPhone:"",oWPResults:[],ocpRslts:[],ocpChangeModel:"",oCPData:"",aChangedCP:[],cpQueryModel:[],ocpAddressRslts:[],stdChangeAddress:"",vChgBpguid2:"",editContactPerson:function(r,c){this.oController=c;if(c.vCurrentActionId==="deleteRB"&&r.BP_RelationsRel.results.length>0){this.setSelectEntityLayout(r);return;}if(c.vCurrentActionId==="changeRB"&&r.BP_RelationsRel.results.length>1){this.setSelectEntityLayout(r);return;}else if(c.vCurrentActionId==="changeRB"&&r.BP_RelationsRel.results.length===1){c.getView().byId("actionStep").setNextStep(c.getView().byId("editStep"));this.editContactPersonPage(0,c);}},setSelectEntityLayout:function(r){var m=new sap.ui.model.json.JSONModel();var s={dataitems:[]};if(this.oController.oCommunicationListRBG===""){this.oController.oCommunicationListRBG=sap.ui.xmlfragment("fcg.mdg.editbp.frag.generic.SelectEntityInstance",this.oController);}else{this.oController.oCommunicationListRBG.destroy();this.oController.oCommunicationListRBG=sap.ui.xmlfragment("fcg.mdg.editbp.frag.generic.SelectEntityInstance",this.oController);}if(this.oController.vCurrentActionId==="deleteRB"){this.oController.getView().byId("actionStep").setNextStep(this.oController.getView().byId("editStep"));if(this.oController.getView().byId("editLayout").getContent().length>0){this.oController.getView().byId("editLayout").removeAllContent();}this.oController.getView().byId("editLayout").setVisible(true);this.oController.getView().byId("editLayout").addContent(this.oController.oCommunicationListRBG);}else{this.oController.getView().byId("actionStep").setNextStep(this.oController.getView().byId("selectEntityInstanceStep"));this.oController.getView().byId("selectEntityInstanceLayout").setVisible(true);this.oController.getView().byId("selectEntityInstanceLayout").addContent(this.oController.oCommunicationListRBG);}for(var i=0;i<r.BP_RelationsRel.results.length;i++){var a=r.BP_RelationsRel.results[i];var p=isNaN(parseInt(a.PARTNER2,10))?a.PARTNER2:parseInt(a.PARTNER2,10);var d={"RBText":a.PARTNER2__TXT+"("+p+")"};s.dataitems.push(d);}var c=sap.ui.getCore().byId("selectDataListRBG");m.setData(s);c.setModel(m);c.setSelectedIndex(-1);},editContactPersonPage:function(a,w){var c,b,d;this.oController=w;var f="";var M=new sap.ui.model.json.JSONModel();fcg.mdg.editbp.handlers.ContactPerson.setWPAddressArray(fcg.mdg.editbp.handlers.ContactPerson.oBPAddrResults);fcg.mdg.editbp.handlers.ContactPerson.setWPIavArray(fcg.mdg.editbp.handlers.ContactPerson.oBPAddrResults);var r=fcg.mdg.editbp.handlers.ContactPerson.getRelResults();if(this.ocpRslts.length>0){var e=[];for(var g=0;g<this.ocpRslts.length;g++){e.push(fcg.mdg.editbp.util.Formatter.removeLeadingZeroes(this.ocpRslts[g].PARTNER));}if(e.indexOf(r.BP_RelationsRel.results[a].PARTNER2)===-1){this.getContactPersonAddressData(r,a);c=this.getContactPersonData(r,a);}else{c=this.ocpRslts[e.indexOf(r.BP_RelationsRel.results[a].PARTNER2)];}}else{this.getContactPersonAddressData(r,a);c=this.getContactPersonData(r,a);}var R=fcg.mdg.editbp.handlers.ContactPerson.oRelResults;if(R.BP_RelationsRel.results.length>1){w.getView().byId("selectEntityInstanceStep").setNextStep(w.getView().byId("editStep"));}if(this.oController.getView().byId("editLayout").getContent().length>0){for(var h=0;h<this.oController.getView().byId("editLayout").getContent().length;h++){this.oController.getView().byId("editLayout").getContent()[h].destroy();h--;}}if(fcg.mdg.editbp.handlers.ContactPerson.oContactPersonLayout===""){fcg.mdg.editbp.handlers.ContactPerson.oContactPersonLayout=sap.ui.xmlfragment("fcg.mdg.editbp.frag.bp.EditContactPerson",fcg.mdg.editbp.handlers.ContactPerson);}else{fcg.mdg.editbp.handlers.ContactPerson.oContactPersonLayout.destroy();fcg.mdg.editbp.handlers.ContactPerson.oContactPersonLayout=sap.ui.xmlfragment("fcg.mdg.editbp.frag.bp.EditContactPerson",fcg.mdg.editbp.handlers.ContactPerson);}w.getView().byId("editLayout").setVisible(true);w.getView().byId("editLayout").removeAllContent();w.getFileUploadData("editLayout");w.getView().byId("editLayout").addContent(fcg.mdg.editbp.handlers.ContactPerson.oContactPersonLayout);f=sap.ui.getCore().byId("SimpleCPForm");fcg.mdg.editbp.handlers.ContactPerson.getValueHelp();M.setData(c.BP_PersonRel);f.setModel(M,"PERSON");sap.ui.getCore().byId("SF-BP_Relation-partnerId").setValue(fcg.mdg.editbp.util.Formatter.removeLeadingZeroes(c.PARTNER));sap.ui.getCore().byId("SF-BP_RelationPartner-title").setSelectedKey(c.TITLE_KEY);sap.ui.getCore().byId("SF-BP_Person-AcadTitle").setSelectedKey(c.BP_PersonRel.TITLE_ACA1);sap.ui.getCore().byId("SF-BP_Person-Gender").setSelectedKey(c.BP_PersonRel.SEX);this.disableContactPersnDtls();var W=R.BP_RelationsRel.results[a].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results;this.oWPResults=W;if(this.oWPResults.length>0){for(var i=0;i<W.length;i++){if(W[i].action!=="D"){d="X";this.oWPModel=new sap.ui.model.json.JSONModel();this.oWPModel.setData(W[i]);if(W.length>0){if(fcg.mdg.editbp.handlers.ContactPerson.oWorkPlaceLayout===""){fcg.mdg.editbp.handlers.ContactPerson.oWorkPlaceLayout=sap.ui.xmlfragment("fcg.mdg.editbp.frag.bp.EditWPAddress",fcg.mdg.editbp.handlers.ContactPerson);}else{try{fcg.mdg.editbp.handlers.ContactPerson.oWorkPlaceLayout.destroy();}catch(n){}fcg.mdg.editbp.handlers.ContactPerson.oWorkPlaceLayout=sap.ui.xmlfragment("fcg.mdg.editbp.frag.bp.EditWPAddress",fcg.mdg.editbp.handlers.ContactPerson);}this.oController.getView().byId("editLayout").addContent(fcg.mdg.editbp.handlers.ContactPerson.oWorkPlaceLayout);sap.ui.getCore().byId("toolWPAdd").attachPress(fcg.mdg.editbp.handlers.ContactPersonCreate.addWPAddress);fcg.mdg.editbp.handlers.ContactPersonCreate.addNewWPAddress();fcg.mdg.editbp.handlers.ContactPerson.oWpNewForm.setModel(this.oWPModel,"WP");if(W[i].BP_WorkplaceCommMobilesRel!==undefined){for(var j=0;j<W[i].BP_WorkplaceCommMobilesRel.results.length;j++){if(W[i].BP_WorkplaceCommMobilesRel.results[j].action!=="D"){var o=new sap.ui.model.json.JSONModel();o.setData(W[i].BP_WorkplaceCommMobilesRel.results[j]);if(j===0){fcg.mdg.editbp.handlers.ContactPerson.oWpNewForm.setModel(o,"mob");var p="mobCPCancel-"+(fcg.mdg.editbp.handlers.ContactPerson.oWpFormId-1);}else{fcg.mdg.editbp.handlers.ContactPersonCreate.addNewMob();fcg.mdg.editbp.handlers.ContactPerson.vNewMobField.setModel(o);}}}}if(W[i].BP_WorkplaceCommPhonesRel!==undefined){for(var k=0;k<W[i].BP_WorkplaceCommPhonesRel.results.length;k++){if(W[i].BP_WorkplaceCommPhonesRel.results[k]!=="D"){var q=new sap.ui.model.json.JSONModel();q.setData(W[i].BP_WorkplaceCommPhonesRel.results[k]);if(k===0){fcg.mdg.editbp.handlers.ContactPerson.oWpNewForm.setModel(q,"tel");var s="telCPCancel-"+(fcg.mdg.editbp.handlers.ContactPerson.oWpFormId-1);}else{fcg.mdg.editbp.handlers.ContactPersonCreate.addNewTel();fcg.mdg.editbp.handlers.ContactPerson.vNewTelField.setModel(q,"tel1");}}}}if(W[i].BP_WorkplaceCommFaxesRel!==undefined){for(var l=0;l<W[i].BP_WorkplaceCommFaxesRel.results.length;l++){if(W[i].BP_WorkplaceCommFaxesRel.results[l]!=="D"){var t=new sap.ui.model.json.JSONModel();t.setData(W[i].BP_WorkplaceCommFaxesRel.results[l]);if(l===0){fcg.mdg.editbp.handlers.ContactPerson.oWpNewForm.setModel(t,"fax");var u="faxCPCancel-"+(fcg.mdg.editbp.handlers.ContactPerson.oWpFormId-1);}else{fcg.mdg.editbp.handlers.ContactPersonCreate.addNewFax();fcg.mdg.editbp.handlers.ContactPerson.vNewFaxField.setModel(t);}}}}if(W[i].BP_WorkplaceCommEMailsRel!==undefined){for(var m=0;m<W[i].BP_WorkplaceCommEMailsRel.results.length;m++){if(W[i].BP_WorkplaceCommEMailsRel.results[m]!=="D"){var v=new sap.ui.model.json.JSONModel();v.setData(W[i].BP_WorkplaceCommEMailsRel.results[m]);if(m===0){fcg.mdg.editbp.handlers.ContactPerson.oWpNewForm.setModel(v,"email");var x="emailCPCancel-"+(fcg.mdg.editbp.handlers.ContactPerson.oWpFormId-1);if(sap.ui.getCore().byId(x).hasListeners("press")===false){sap.ui.getCore().byId(x).attachPress(fcg.mdg.editbp.handlers.ContactPersonCreate.removeFormElement);sap.ui.getCore().byId(x).removeStyleClass("sapGreyCell");}}else{fcg.mdg.editbp.handlers.ContactPersonCreate.addNewEmail();fcg.mdg.editbp.handlers.ContactPerson.vNewEmailField.setModel(v);}}}}}}else{fcg.mdg.editbp.handlers.ContactPerson.oWpFormId=fcg.mdg.editbp.handlers.ContactPerson.oWpFormId+1;}}if(d!=="X"){this.loadWpLayout();}}else{var y=fcg.mdg.editbp.handlers.ContactPerson.getWPAddressArray();if(y.results.length>0){this.loadWpLayout();}}},loadWpLayout:function(){if(fcg.mdg.editbp.handlers.ContactPerson.oWorkPlaceLayout===""){fcg.mdg.editbp.handlers.ContactPerson.oWorkPlaceLayout=sap.ui.xmlfragment("fcg.mdg.editbp.frag.bp.EditWPAddress",fcg.mdg.editbp.handlers.ContactPerson);}else{try{fcg.mdg.editbp.handlers.ContactPerson.oWorkPlaceLayout.destroy();}catch(e){}fcg.mdg.editbp.handlers.ContactPerson.oWorkPlaceLayout=sap.ui.xmlfragment("fcg.mdg.editbp.frag.bp.EditWPAddress",fcg.mdg.editbp.handlers.ContactPerson);}this.oController.getView().byId("editLayout").addContent(fcg.mdg.editbp.handlers.ContactPerson.oWorkPlaceLayout);sap.ui.getCore().byId("toolWPAdd").attachPress(fcg.mdg.editbp.handlers.ContactPersonCreate.addWPAddress);},disableContactPersnDtls:function(){sap.ui.getCore().byId("SF-BP_Relation-partnerId").setEnabled(false);sap.ui.getCore().byId("SF-BP_RelationPartner-title").setEnabled(false);sap.ui.getCore().byId("SF-BP_Person-AcadTitle").setEnabled(false);sap.ui.getCore().byId("SF-BP_Person-Gender").setEnabled(false);sap.ui.getCore().byId("SF-BP_Person-FirstName").setEnabled(false);sap.ui.getCore().byId("SF-BP_Person-LastName").setEnabled(false);sap.ui.getCore().byId("SF-BP_Person-LanguageKey").setEnabled(false);},setCPResults:function(r){this.oCPResults=r;},getCPResults:function(){return this.oCPResults;},getContactPersonData:function(r,i){var b=r.BP_RelationsRel.results[i].BP_GUID2;b=b.replace(/-/g,'');b=b.toUpperCase();var p="/BP_RootCollection(BP_GUID=binary'"+b+"')?$expand=";var P=p+"BP_PersonRel";var a=fcg.mdg.editbp.util.DataAccess.readData(P,this.oController);this.ocpRslts.push(a);return a;},getContactPersonAddressData:function(r,a){var t=this;var b=r.BP_RelationsRel.results[a].BP_GUID2;b=b.replace(/-/g,'');b=b.toUpperCase();this.vChgBpguid2=b;var p="/BP_RootCollection(BP_GUID=binary'"+b+"')?$expand=";var P=p+"BP_AddressesRel,BP_AddressesRel/BP_AddressVersionsPersRel/BP_AddressPersonVersionRel,BP_AddressUsagesRel";var d=new sap.ui.model.odata.ODataModel(this.oController.getView().getModel().sServiceUrl,true);d.read(P,null,null,true,function(c){var R=c;for(var i=0;i<R.BP_AddressUsagesRel.results.length;i++){if(R.BP_AddressUsagesRel.results[i].ADDRESSTYPE==="XXDEFAULT"){for(var j=0;j<R.BP_AddressesRel.results.length;j++){if(R.BP_AddressesRel.results[j].AD_ID!==R.BP_AddressUsagesRel.results[i].AD_ID){R.BP_AddressesRel.results.splice(j,1);}}}}t.stdChangeAddress=R.BP_AddressesRel.results;t.ocpAddressRslts.push(R);return R;});},changeModel:function(c){var s;var r=fcg.mdg.editbp.handlers.ContactPerson.oRelResults;var C=this.ocpRslts;if(r.BP_RelationsRel.results.length===1){s=0;}else{if(sap.ui.getCore().byId("selectDataListRBG")!==undefined){s=sap.ui.getCore().byId("selectDataListRBG").getSelectedIndex();}}for(var p=0;p<C.length;p++){var v=fcg.mdg.editbp.util.Formatter.removeLeadingZeroes(C[p].PARTNER);if(v===r.BP_RelationsRel.results[s].PARTNER2){var d=p;}}r.BP_RelationsRel.results[s].SelectIndex=s;var e=(JSON.parse(JSON.stringify(c.changedArray)));for(var i=0;i<e.length;i++){var f;switch(e[i].entity){case"BP_RelationPartner":C[d][e[i].field]=e[i].value;C[d].ChangeData[e[i].field]=e[i].value;break;case"BP_Person":C[d].BP_PersonRel[e[i].field]=e[i].value;C[d].BP_PersonRel.ChangeData[e[i].field]=e[i].value;break;case"BP_ContactPersonWorkplacesRel":if(e[i].action==="N"&&(r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].wpKey]===undefined||r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].wpKey].action==='D'||r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].wpKey].createdIndex!==e[i].createdIndex)){var n={};var g={};r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results.push(n);var h=e[i].currentEntityKey;var w=e[i].wpKey;e[i].currentEntityKey=r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results.length-1;for(var j=i+1;j<e.length;j++){if(e[j].currentEntityKey===h&&e[j].wpKey===w&&e[j].cpIndex===e[i].cpIndex){e[j].addrIndex=e[i].currentEntityKey;e[j].wpKey=e[i].currentEntityKey;}}e[i].wpKey=e[i].currentEntityKey;r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].wpKey]["ChangeData"]=g;if(r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results.length<=1){r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].wpKey]["STANDARDADDRESS"]="X";r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].wpKey].ChangeData["STANDARDADDRESS"]="X";}}if(e[i].value!==undefined){if(e[i].field==="ADDRESS_NUMBER"){r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].wpKey][e[i].field]=e[i].key;r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].wpKey]["ADDRESS_NUMBER__TXT"]=e[i].value;r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].wpKey].ChangeData[e[i].field]=e[i].key;r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].wpKey].ChangeData["ADDRESS_NUMBER__TXT"]=e[i].value;}else{r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].wpKey][e[i].field]=e[i].value;r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].wpKey].ChangeData[e[i].field]=e[i].value;}}r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].wpKey]["createdIndex"]=e[i].createdIndex;r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].wpKey]["header"]=e[i].currentkey;f=r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].wpKey].action;if(f===undefined||f!=="N"){if(e[i].action===undefined){r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].wpKey]["action"]="U";}else{r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].wpKey]["action"]=e[i].action;}}break;case"BP_WorkplaceIntAddressVersRel":var N={};if(e[i].action==="N"&&r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceIntAddressVersRel===undefined){r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex]["BP_WorkplaceIntAddressVersRel"]={};r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceIntAddressVersRel["results"]=[];}if(e[i].action==="N"&&r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceIntAddressVersRel.results[e[i].currentEntityKey]===undefined){var N={};var g={};var P={};r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceIntAddressVersRel.results.push(N);var k=e[i].currentEntityKey;var l=e[i].wpKey;e[i].currentEntityKey=r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceIntAddressVersRel.results.length-1;if(e[i].currentEntityKey<0){e[i].currentEntityKey=0;}for(var j=i+1;j<e.length;j++){if((e[j].entity==="BP_WorkplaceIntAddressVersRel"||e[j].entity==="BP_WorkplaceIntPersVersionRel")&&e[j].currentEntityKey===k&&e[j].wpKey===l){e[j].currentEntityKey=e[i].currentEntityKey;}}r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceIntAddressVersRel.results[e[i].currentEntityKey]["ChangeData"]=g;r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceIntAddressVersRel.results[e[i].currentEntityKey]["BP_WorkplaceIntPersVersionRel"]=P;r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceIntAddressVersRel.results[e[i].currentEntityKey].BP_WorkplaceIntPersVersionRel["ChangeData"]={};}if(e[i].value!==undefined){if(e[i].field==="ADDR_VERS"){r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceIntAddressVersRel.results[e[i].currentEntityKey][e[i].field]=e[i].key;r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceIntAddressVersRel.results[e[i].currentEntityKey][e[i].field+"__TXT"]=e[i].value;r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceIntAddressVersRel.results[e[i].currentEntityKey].ChangeData[e[i].field]=e[i].key;r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceIntAddressVersRel.results[e[i].currentEntityKey].ChangeData[e[i].field+"__TXT"]=e[i].value;}else{r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceIntAddressVersRel.results[e[i].currentEntityKey][e[i].field]=e[i].value;r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceIntAddressVersRel.results[e[i].currentEntityKey].ChangeData[e[i].field]=e[i].value;}}r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceIntAddressVersRel.results[e[i].currentEntityKey]["header"]=e[i].currentkey;f=r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceIntAddressVersRel.results[e[i].currentEntityKey].action;if(f===undefined||f!=="N"){if(e[i].action===undefined){r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceIntAddressVersRel.results[e[i].currentEntityKey]["action"]="U";}else{r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceIntAddressVersRel.results[e[i].currentEntityKey]["action"]=e[i].action;}}break;case"BP_WorkplaceIntPersVersionRel":if(r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].wpKey].action==="N"){e[i].addrIndex=e[i].wpKey;}if(e[i].value!==undefined){if(e[i].field==="TITLE_P"){r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceIntAddressVersRel.results[e[i].currentEntityKey].BP_WorkplaceIntPersVersionRel[e[i].field]=e[i].key;r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceIntAddressVersRel.results[e[i].currentEntityKey].BP_WorkplaceIntPersVersionRel[e[i].field+"__TXT"]=e[i].value;r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceIntAddressVersRel.results[e[i].currentEntityKey].BP_WorkplaceIntPersVersionRel.ChangeData[e[i].field]=e[i].key;r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceIntAddressVersRel.results[e[i].currentEntityKey].BP_WorkplaceIntPersVersionRel.ChangeData[e[i].field+"__TXT"]=e[i].value;}else{r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceIntAddressVersRel.results[e[i].currentEntityKey].BP_WorkplaceIntPersVersionRel[e[i].field]=e[i].value;r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceIntAddressVersRel.results[e[i].currentEntityKey].BP_WorkplaceIntPersVersionRel.ChangeData[e[i].field]=e[i].value;}}r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceIntAddressVersRel.results[e[i].currentEntityKey].BP_WorkplaceIntPersVersionRel["header"]=e[i].currentkey;f=r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceIntAddressVersRel.results[e[i].currentEntityKey].BP_WorkplaceIntPersVersionRel.action;if(f===undefined||f!=="N"){if(e[i].action===undefined){r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceIntAddressVersRel.results[e[i].currentEntityKey].BP_WorkplaceIntPersVersionRel["action"]="U";}else{r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceIntAddressVersRel.results[e[i].currentEntityKey].BP_WorkplaceIntPersVersionRel["action"]=e[i].action;}}break;case"BP_WorkplaceCommPhonesRel":var o={};if(e[i].action==="N"&&r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommPhonesRel===undefined){r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex]["BP_WorkplaceCommPhonesRel"]={};r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommPhonesRel["results"]=[];}if(e[i].action==="N"&&r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommPhonesRel.results[e[i].currentEntityKey]===undefined){var o={};var g={};r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommPhonesRel.results.push(o);var m=e[i].currentEntityKey;var q=e[i].wpKey;e[i].currentEntityKey=r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommPhonesRel.results.length-1;if(e[i].currentEntityKey<0){e[i].currentEntityKey=0;}for(var j=i+1;j<e.length;j++){if(e[j].entity==="BP_WorkplaceCommPhonesRel"&&e[j].currentEntityKey===m&&e[j].wpKey===q){e[j].currentEntityKey=e[i].currentEntityKey;}}r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommPhonesRel.results[e[i].currentEntityKey]["ChangeData"]=g;if(r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommPhonesRel.results.length<=1){r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommPhonesRel.results[e[i].currentEntityKey]["R_3_USER"]="1";r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommPhonesRel.results[e[i].currentEntityKey].ChangeData["R_3_USER"]="1";r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommPhonesRel.results[e[i].currentEntityKey]["STD_NO"]="X";r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommPhonesRel.results[e[i].currentEntityKey].ChangeData["STD_NO"]="X";}else{r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommPhonesRel.results[e[i].currentEntityKey]["R_3_USER"]="";r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommPhonesRel.results[e[i].currentEntityKey].ChangeData["R_3_USER"]="";}}if(e[i].value!==undefined){r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommPhonesRel.results[e[i].currentEntityKey][e[i].field]=e[i].value;r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommPhonesRel.results[e[i].currentEntityKey].ChangeData[e[i].field]=e[i].value;}r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommPhonesRel.results[e[i].currentEntityKey]["header"]=e[i].currentkey;f=r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommPhonesRel.results[e[i].currentEntityKey].action;if(f===undefined||f!=="N"){if(e[i].action===undefined){r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommPhonesRel.results[e[i].currentEntityKey]["action"]="U";}else{r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommPhonesRel.results[e[i].currentEntityKey]["action"]=e[i].action;}}break;case"BP_WorkplaceCommMobilesRel":var t={};if(e[i].action==="N"&&r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommMobilesRel===undefined){r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex]["BP_WorkplaceCommMobilesRel"]={};r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommMobilesRel["results"]=[];}if(e[i].action==="N"&&r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommMobilesRel.results[e[i].currentEntityKey]===undefined){var t={};var u={};r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommMobilesRel.results.push(t);var x=e[i].currentEntityKey;var y=e[i].wpKey;e[i].currentEntityKey=r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommMobilesRel.results.length-1;if(e[i].currentEntityKey<0){e[i].currentEntityKey=0;}for(var j=i+1;j<e.length;j++){if(e[j].entity==="BP_WorkplaceCommMobilesRel"&&e[j].currentEntityKey===x&&e[j].wpKey===y){e[j].currentEntityKey=e[i].currentEntityKey;}}r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommMobilesRel.results[e[i].currentEntityKey]["ChangeData"]=u;if(r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommMobilesRel.results.length<=1){r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommMobilesRel.results[e[i].currentEntityKey]["R_3_USER"]="3";r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommMobilesRel.results[e[i].currentEntityKey].ChangeData["R_3_USER"]="3";r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommMobilesRel.results[e[i].currentEntityKey]["STD_NO"]="X";r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommMobilesRel.results[e[i].currentEntityKey].ChangeData["STD_NO"]="X";}else{r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommMobilesRel.results[e[i].currentEntityKey]["R_3_USER"]="2";r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommMobilesRel.results[e[i].currentEntityKey].ChangeData["R_3_USER"]="2";}}if(e[i].value!==undefined){r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommMobilesRel.results[e[i].currentEntityKey][e[i].field]=e[i].value;r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommMobilesRel.results[e[i].currentEntityKey].ChangeData[e[i].field]=e[i].value;}r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommMobilesRel.results[e[i].currentEntityKey]["header"]=e[i].currentkey;f=r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommMobilesRel.results[e[i].currentEntityKey].action;if(f===undefined||f!=="N"){if(e[i].action===undefined){r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommMobilesRel.results[e[i].currentEntityKey]["action"]="U";}else{r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommMobilesRel.results[e[i].currentEntityKey]["action"]=e[i].action;}}break;case"BP_WorkplaceCommFaxesRel":var z={};if(e[i].action==="N"&&r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommFaxesRel===undefined){r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex]["BP_WorkplaceCommFaxesRel"]={};r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommFaxesRel["results"]=[];}if(e[i].action==="N"&&r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommFaxesRel.results[e[i].currentEntityKey]===undefined){var z={};var A={};r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommFaxesRel.results.push(z);var B=e[i].currentEntityKey;var D=e[i].wpKey;e[i].currentEntityKey=r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommFaxesRel.results.length-1;if(e[i].currentEntityKey<0){e[i].currentEntityKey=0;}for(var j=i+1;j<e.length;j++){if(e[j].entity==="BP_WorkplaceCommFaxesRel"&&e[j].currentEntityKey===B&&e[j].wpKey===D){e[j].currentEntityKey=e[i].currentEntityKey;}}r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommFaxesRel.results[e[i].currentEntityKey]["ChangeData"]=A;if(r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommFaxesRel.results.length<=1){r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommFaxesRel.results[e[i].currentEntityKey]["STD_NO"]="X";r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommFaxesRel.results[e[i].currentEntityKey].ChangeData["STD_NO"]="X";}}if(e[i].value!==undefined){r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommFaxesRel.results[e[i].currentEntityKey][e[i].field]=e[i].value;r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommFaxesRel.results[e[i].currentEntityKey].ChangeData[e[i].field]=e[i].value;}r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommFaxesRel.results[e[i].currentEntityKey]["header"]=e[i].currentkey;f=r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommFaxesRel.results[e[i].currentEntityKey].action;if(f===undefined||f!=="N"){if(e[i].action===undefined){r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommFaxesRel.results[e[i].currentEntityKey]["action"]="U";}else{r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommFaxesRel.results[e[i].currentEntityKey]["action"]=e[i].action;}}break;case"BP_WorkplaceCommEMailsRel":if(e[i].action==="N"&&r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommEMailsRel===undefined){r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex]["BP_WorkplaceCommEMailsRel"]={};r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommEMailsRel["results"]=[];}if(e[i].action==="N"&&r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommEMailsRel.results[e[i].currentEntityKey]===undefined){var E={};var F={};r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommEMailsRel.results.push(E);var G=e[i].currentEntityKey;var H=e[i].wpKey;e[i].currentEntityKey=r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommEMailsRel.results.length-1;if(e[i].currentEntityKey<0){e[i].currentEntityKey=0;}for(var j=i+1;j<e.length;j++){if(e[j].entity==="BP_WorkplaceCommEMailsRel"&&e[j].currentEntityKey===G&&e[j].wpKey===H){e[j].currentEntityKey=e[i].currentEntityKey;}}r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommEMailsRel.results[e[i].currentEntityKey]["ChangeData"]=F;if(r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommEMailsRel.results.length<=1){r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommEMailsRel.results[e[i].currentEntityKey]["STD_NO"]="X";r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommEMailsRel.results[e[i].currentEntityKey].ChangeData["STD_NO"]="X";}}if(e[i].value!==undefined){r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommEMailsRel.results[e[i].currentEntityKey][e[i].field]=e[i].value;r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommEMailsRel.results[e[i].currentEntityKey].ChangeData[e[i].field]=e[i].value;}r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommEMailsRel.results[e[i].currentEntityKey]["header"]=e[i].currentkey;f=r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommEMailsRel.results[e[i].currentEntityKey].action;if(f===undefined||f!=="N"){if(e[i].action===undefined){r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommEMailsRel.results[e[i].currentEntityKey]["action"]="U";}else{r.BP_RelationsRel.results[s].BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results[e[i].addrIndex].BP_WorkplaceCommEMailsRel.results[e[i].currentEntityKey]["action"]=e[i].action;}}break;default:}}if(r.BP_RelationsRel.results[s].EDIT!=="X"){this.aChangedCP.push(r.BP_RelationsRel.results[s].PARTNER2);}this.ocpChangeModel=r.BP_RelationsRel.results[s];if(c.isAddressVisited==="X"){var I=fcg.mdg.editbp.handlers.ContactPerson.oController.oDetailComm.BP_AddressesRel.results;var J=this.ocpChangeModel.BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results;for(var a=0;a<I.length;a++){for(var b=0;b<J.length;b++){if(J[b].ADDRESS_NUMBER===I[a].AD_ID){J[b].ADDRESS_NUMBER__TXT=I[a].AD_ID__TXT;}}}}this.oCPData=C[d];if(r.BP_RelationsRel.results[s].EDIT!=="X"){this.cpQueryModel.push(this.ocpChangeModel);}else{var K=this.aChangedCP.indexOf(r.BP_RelationsRel.results[s].PARTNER2);this.cpQueryModel[K]=this.ocpChangeModel;}var L=this.oController.bpHookModifyCPChangeModel(this);if(L!==undefined){this.cpQueryModel=L;}},undoContactPersonChanges:function(a,e){var c,I;if(a===0){fcg.mdg.editbp.handlers.ContactPerson.aCPQueryModel.splice(e,1);}else if(a===1){var d=new sap.ui.model.odata.ODataModel(this.oController.getView().getModel().sServiceUrl,false);var p="/BP_RootCollection(BP_GUID="+this.oController.sItemPath+")?$expand=";var r=p+"BP_RelationsRel,BP_RelationsRel/BP_RelationContactPersonRel,BP_RelationsRel/BP_RelationContactPersonRel/BP_ContactPersonWorkplacesRel,BP_RelationsRel/BP_RelationContactPersonRel/BP_ContactPersonWorkplacesRel/BP_WorkplaceCommEMailsRel,BP_RelationsRel/BP_RelationContactPersonRel/BP_ContactPersonWorkplacesRel/BP_WorkplaceCommPhonesRel,BP_RelationsRel/BP_RelationContactPersonRel/BP_ContactPersonWorkplacesRel/BP_WorkplaceCommMobilesRel,BP_RelationsRel/BP_RelationContactPersonRel/BP_ContactPersonWorkplacesRel/BP_WorkplaceCommFaxesRel,BP_RelationsRel/BP_RelationContactPersonRel/BP_ContactPersonWorkplacesRel/BP_WorkplaceIntAddressVersRel,BP_RelationsRel/BP_RelationContactPersonRel/BP_ContactPersonWorkplacesRel/BP_WorkplaceIntAddressVersRel/BP_WorkplaceIntPersVersionRel";this.aChangedCP.splice(e,1);c=fcg.mdg.editbp.handlers.ContactPersonChange.cpQueryModel[e].PARTNER2;I=fcg.mdg.editbp.handlers.ContactPerson.aInitilCP.indexOf(c);for(var i=0;i<fcg.mdg.editbp.handlers.ContactPerson.oRelResults.BP_RelationsRel.results.length;i++){if(c===fcg.mdg.editbp.handlers.ContactPerson.oRelResults.BP_RelationsRel.results[i].PARTNER2){var v=i;}}for(i=0;i<this.oController.aEntityValue.length;i++){if("ContactPerRB-"+c===this.oController.aEntityValue[i]){this.oController.aEntityValue.splice(i,1);break;}}this.cpQueryModel.splice(e,1);this.oController.aEntityValue.splice(e,1);d.read(r,null,null,true,function(h,E){if(h.BP_RelationsRel.results.length>0){fcg.mdg.editbp.handlers.ContactPerson.oRelResults.BP_RelationsRel.results[v]=h.BP_RelationsRel.results[I];}});}else if(a===2){var A=[];var b=fcg.mdg.editbp.handlers.Communication.oDeleteModel;var f=this.oCPDeleteQueryModel[e].body.BP_RelationContactPersonRel.BP_ContactPersonWorkplacesRel.results;for(var i=0;i<b.length;++i){A.push(b[i].body.AD_ID);}for(var i=0;i<f.length;++i){if(A.indexOf(f[i].ADDRESS_NUMBER)!==-1){this.showPopUp(this.oController,this.oController.getView().getModel("i18n").getResourceBundle().getText("ERROR_CP_REVERT"));return"ERROR";}}A=[];var B=fcg.mdg.editbp.handlers.ContactPerson.oBPAddrResults.BP_AddressesRel.results;for(var i=0;i<B.length;++i){if(A.indexOf(B[i].AD_ID)===-1)A.push(B[i].AD_ID);}var g=fcg.mdg.editbp.handlers.Communication.oCreateModel;for(var i=0;i<g.length;++i){if(A.indexOf(g[i].body.AD_ID)===-1)A.push(g[i].body.AD_ID);}for(var i=0;i<f.length;++i){if(A.indexOf(f[i].ADDRESS_NUMBER)===-1){this.showPopUp(this.oController,this.oController.getView().getModel("i18n").getResourceBundle().getText("ERROR_CP_REVERT"));return"ERROR";}}for(i=0;i<this.oController.aEntityValue.length;i++){if("ContactPerRB-"+this.oCPDeleteQueryModel[e].body.PARTNER2===this.oController.aEntityValue[i]){this.oController.aEntityValue.splice(i,1);break;}}fcg.mdg.editbp.handlers.ContactPerson.oRelResults.BP_RelationsRel.results.push(this.oCPDeleteQueryModel[e].body);this.oCPDeleteQueryModel.splice(e,1);}},deleteModel:function(c){this.oController=c;var d={};var s="";if(sap.ui.getCore().byId("selectDataListRBG")!==undefined){s=sap.ui.getCore().byId("selectDataListRBG").getSelectedIndex();}var r=fcg.mdg.editbp.handlers.ContactPerson.getRelResults();var p=this.getContactPersonData(r,s);var a="/BP_RootCollection(BP_GUID="+this.oController.sItemPath+")?$expand=";var R=a+"BP_RelationsRel,BP_RelationsRel/BP_RelationContactPersonRel,BP_RelationsRel/BP_RelationContactPersonRel/BP_ContactPersonWorkplacesRel,BP_RelationsRel/BP_RelationContactPersonRel/BP_ContactPersonWorkplacesRel/BP_WorkplaceCommEMailsRel,BP_RelationsRel/BP_RelationContactPersonRel/BP_ContactPersonWorkplacesRel/BP_WorkplaceCommPhonesRel,BP_RelationsRel/BP_RelationContactPersonRel/BP_ContactPersonWorkplacesRel/BP_WorkplaceCommMobilesRel,BP_RelationsRel/BP_RelationContactPersonRel/BP_ContactPersonWorkplacesRel/BP_WorkplaceCommFaxesRel,BP_RelationsRel/BP_RelationContactPersonRel/BP_ContactPersonWorkplacesRel/BP_WorkplaceIntAddressVersRel,BP_RelationsRel/BP_RelationContactPersonRel/BP_ContactPersonWorkplacesRel/BP_WorkplaceIntAddressVersRel/BP_WorkplaceIntPersVersionRel";var b=fcg.mdg.editbp.util.DataAccess.readData(R,this.oController);var B=fcg.mdg.editbp.handlers.ContactPerson.oRelResults.BP_RelationsRel;var S=-1;for(var i=0;i<b.BP_RelationsRel.results.length;++i){if(b.BP_RelationsRel.results[i].PARTNER2===B.results[s].PARTNER2){S=i;break;}}B.results[s]=b.BP_RelationsRel.results[S];B.results[s].SelectIndex=s;B.results[s].PersonRel=p.BP_PersonRel;d.body=B.results[s];fcg.mdg.editbp.handlers.ContactPerson.cpDesc=fcg.mdg.editbp.util.Formatter.descriptionAndCode(d.body.PARTNER2__TXT,d.body.PARTNER2);var e=fcg.mdg.editbp.handlers.ContactPerson.pad(d.body.PARTNER2,10);if(this.oController.vTimedependency==="X"){var f=fcg.mdg.editbp.util.Formatter.validUntilDateFormat(d.body.VALIDUNTILDATE);f=escape(f);d.header="BP_RelationCollection(BP_GUID="+c.sItemPath+",PARTNER1='"+d.body.PARTNER1+"',PARTNER2='"+e+"',RELATIONSHIPCATEGORY='"+d.body.RELATIONSHIPCATEGORY+"',VALIDUNTILDATE=datetime'"+f+"')";}else{d.header="BP_RelationCollection(BP_GUID="+c.sItemPath+",PARTNER1='"+d.body.PARTNER1+"',PARTNER2='"+e+"',RELATIONSHIPCATEGORY='"+d.body.RELATIONSHIPCATEGORY+"')";}B.results.splice(s,1);this.oCPDeleteQueryModel.push(d);var l=d.body;l.ChangeData={};this.oCPDeleteModel=l;if(this.aChangedCP.length>0){if(this.aChangedCP.indexOf(d.body.PARTNER2)>-1){var C=this.aChangedCP.indexOf(d.body.PARTNER2);this.aChangedCP.splice(C,1);this.cpQueryModel.splice(C,1);c.getView().byId("cpChangeLayout").getContent()[C].destroy();}}var E=this.oController.bpHookModifyCPDeleteModel(this);if(E!==undefined){this.oCPDeleteModel=E;}},isNull:function(v){return typeof v==="undefined"||v==="unknown"||v===null||v==="null"||v===""||parseInt(v,10)===0;},showPopUp:function(w,t){var d=new sap.m.Dialog({title:w.getView().getModel("i18n").getResourceBundle().getText("ERROR"),type:"Message",state:w.getView().getModel("i18n").getResourceBundle().getText("ERROR"),content:[new sap.m.Text({text:t})],beginButton:new sap.m.Button({text:w.getView().getModel("i18n").getResourceBundle().getText("OK"),press:function(){d.close();}}),afterClose:function(){d.destroy();}});d.open();}};
